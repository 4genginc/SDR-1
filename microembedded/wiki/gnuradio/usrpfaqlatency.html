<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage"><!-- InstanceBegin template="/Templates/gnuradio.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<link rel="shortcut icon" type="image/x-icon" href="../images/sites-16.ico" />
<!--声明当前的页面的编码集-->
<meta charset="utf-8"/>
<meta name="title" content="GNU Radio 中文社区">
<meta itemprop="name" content="GNU Radio 中文社区">
<meta property="og:title" content="GNU Radio 中文社区">
<meta name="description" content="微嵌 - GNU Radio 中文维客 由 微嵌软件技术(北京)有限责任公司维护。GNU Radio 是免费的软件开发工具套件。它提供信号运行和处理模块，用它可以在易制作的低成本的射频（RF）硬件（比如：USRP 和USRP2）和通用微处理器上实现软件定义无线电。这套套件广泛用于业余爱好者，学术机构和商业机构用来研究和构建无线通信系统。">
<meta itemprop="description" content="微嵌 - GNU Radio 中文维客 由 微嵌软件技术(北京)有限责任公司维护。GNU Radio 是免费的软件开发工具套件。它提供信号运行和处理模块，用它可以在易制作的低成本的射频（RF）硬件（比如：USRP 和USRP2）和通用微处理器上实现软件定义无线电。这套套件广泛用于业余爱好者，学术机构和商业机构用来研究和构建无线通信系统。">
<meta id="meta-tag-description" property="og:description" content="微嵌 - GNU Radio 中文维客 由 微嵌软件技术(北京)有限责任公司维护。GNU Radio 是免费的软件开发工具套件。它提供信号运行和处理模块，用它可以在易制作的低成本的射频（RF）硬件（比如：USRP 和USRP2）和通用微处理器上实现软件定义无线电。这套套件广泛用于业余爱好者，学术机构和商业机构用来研究和构建无线通信系统。">
<!-- InstanceBeginEditable name="doctitle" -->
<title>GNU Radio 中文社区</title>
<!-- InstanceEndEditable -->
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >
<link rel="stylesheet" type="text/css" href="../css/css.css">
<link rel="stylesheet" type="text/css" href="../css/overlay.css">
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" zh_CN">
<div id="sites-chrome-everything-scrollbar">
    <div id="sites-chrome-everything" class="">
        <div id="sites-chrome-page-wrapper" style="direction: ltr">
            <div id="sites-chrome-page-wrapper-inside">
                <div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="height:auto;">
                    <table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="height:auto;">
                        <tbody>
                            <tr class="sites-header-primary-row" id="sites-chrome-userheader">
                                <td id="sites-header-title" class="sites-chrome-header-valign-bottom"><div class="sites-header-cell-buffer-wrapper">
                                        <h2><a href="http://gnuradio.microembedded.com/" id="sites-chrome-userheader-logo"> <img id="logo-img-id" src="../images/logo.jpg" alt="GNU Radio 中文社区" class="sites-logo sites-chrome-header-valign-bottom "></a></h2>
                                    </div></td>
                            </tr>
                            <tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
                                <td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="sites-chrome-main-wrapper">
                    <div id="sites-chrome-main-wrapper-inside">
                    <!-- InstanceBeginEditable name="head" -->
                    <table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tbody><tr>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="display: none;">
</div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="display: none;" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">UsrpFAQLatency</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr">
<div>
<p><b><font size="3">时延</font></b></p><div style="text-align:right"><p><font size="2"><b>[ <a href="usrpfaqbitstream.html">&lt;&lt;
 装载 FPGA 微码</a> | <a href="usrpfaq.html">^ USRP 
FAQ 首页 ^</a> | <a href="usrpfaqfx2.html">FX2 
USB 控制器 &gt;&gt;</a> 
] </b><br></font></p></div><font size="2"><br></font>
<ul><li><font size="2"><b>We can calculate the latency introduced by the USB since the USB packet 
is only sent when we have a sufficient amount of data collected in the USRP 
buffer, i.e., the smallest allowed USB packet is 512 byte, and the largest one 
is specified by the user by two parameters, fusb_nblock and fusb_block_size. As 
a <a href="http://nesl.ee.ucla.edu/document/show/242" rel="nofollow"><span>paper</span></a> mentions, the USB delay (Tu) is according to the 
equation: </b><br></font><font face="Courier New" size="2">Tu = f(512, 
fusb_block_size*fusb_nblock) / (fs*sample_size )<br></font><font size="2"><b>Where:f(x,y) is 
depends on the data in the buffer and it is at least x and at most y and fs is 
the sampling frequency. Since we use complex 16 bit samples, the sample size is 
</b><br></font><font face="Courier New" size="2">sample_ size = 2 * 16bit= 4 
bytes<br></font><font size="2"><b>So, does that mean if we have large product of 
fusb_block_size and fusb_nblock, then the theoretical maximum delay will be 
increased? </b></font></li></ul>
<blockquote>
<p><font size="2">Yes that is true. If you're trying to minimize latency you want the smallest 
values that work reliably (no over/underruns) and with acceptable overhead. If 
you enable real time scheduling, you can reliably use smaller values. Try 
fusb_block_size 2048 and fusb_nblock 4 or 8. You may be able to run with 
fusb_block_size 1024. It depends on your data rate across the USB. 
</font></p></blockquote>
<ul><li><font size="2"><b>What is the theoretical minimum roundtrip latency that we can achieve 
with the USRP? </b></font></li></ul>
<blockquote>
<blockquote>
<p><font size="2">Different cases:<br><br></font></p></blockquote>
<p><font size="2">1) On the host I think that the minimum number of packet buffers we can live 
with is 2 in each direction. This is to ensure that the EHCI USB host controller 
end point queue always has something in it for our end points. This is required 
to keep the throughput up and to keep us from suffering underrun or overruns on 
the USRP.<br><br></font></p></blockquote>
<blockquote>
<p><font size="2">2) On the FX2 the minimum we can use is two in each 
direction.<br><br></font></p></blockquote>
<blockquote>
<p><font size="2">3) On the output path to the FPGA, there's a FIFO, but the pipeline runs if 
there's any data in the FIFO. This doesn't appear to add any delay. In USRP, 
we're currently running with 512 byte packets.<br><br></font></p></blockquote>
<blockquote>
<p><font size="2">Theoretical Calculations:<br><br>Let the PKTSIZE = 512. In both directions we 
can't start the transport until you've assembled a full packet. Assume we're 
running at 32MB/sec, t0 = 16usec. The transport time of a single packet from the 
host controller to the FX2 is <br></font></p></blockquote>
<blockquote>
<blockquote>
<p><font size="2">t1 = PKTSIZE (bytes)/32(Mbyte/sec) = 16 
usec<br></font></p></blockquote></blockquote>
<blockquote>
<p><font size="2">The transport time of a single packet from the FX2 to the FPGA is 
about<br></font></p></blockquote>
<blockquote>
<blockquote>
<p><font size="2">t2 = 4 us + PKTSIZE (bytes)/96(Mbyte/sec) = 9.33 
usec<br></font></p></blockquote></blockquote>
<blockquote>
<p><font size="2">[The 4 us is firmware overhead in the FX2. It could be 
improved]<br><br></font></p></blockquote>
<blockquote>
<p><font size="2">The best case:<br><br>Outbound looks like = t0 + t1 + t2 = 41.33 usec. 
Inbound is the same 41.33 usec. <br><br></font></p></blockquote>
<blockquote>
<p><font size="2">With 512 byte packets, total round trip latency<br></font></p></blockquote>
<blockquote>
<blockquote>
<p><font size="2">2 * (t0 + t1 + t2) = 83 usec<br></font></p></blockquote></blockquote>
<blockquote>
<p><font size="2">Lowering the packet size to 64 bytes would reduce this 
to<br></font></p></blockquote>
<blockquote>
<blockquote>
<p><font size="2">2 * (2 + 2 + 4.7) = 8.7 us <br></font></p></blockquote>
<p><font size="2">[This is optimistic, since our throughput will drop, and there are lots of 
other unaccounted factors. E.g., greater USB overhead because of the small 
packets]<br></font></p></blockquote>
<ul><li><font size="2"><b>How we can practically measure the round trip latency? </b></font></li></ul>
<blockquote>
<blockquote>
<p><font size="2">Here's an easy way to measure round trip latency:<br>Hook up a signal 
generator to one of the Rx basic inputs and to one input of an oscilloscope. 
Hook up one Tx basic output to another input on the o'scope. Write some code on 
the host that reads from usrp.source_c and writes to usrp.sink_c Look at the 
delay between the two traces on your o'scope. </font></p></blockquote></blockquote>
<font size="2"><br><br><br></font>
<p style="text-align:right"><font size="2"><b>[ <a href="usrpfaqbitstream.html">&lt;&lt; 装载 FPGA 微码</a> | <a href="usrpfaq.html">^ USRP 
FAQ 首页 ^</a> | <a href="usrpfaqfx2.html">FX2 USB 控制器 &gt;&gt;</a> 
] </b><br></font></p><p><font size="2"><br></font></p><p><font size="2"><br></font></p><p><font size="2"><br></font></p><p><font size="2"><br></font></p><p><font size="2"><br></font></p><p><font size="2"><b><br><br>注：<a href="http://gnuradio.org/redmine/projects/gnuradio/wiki/UsrpFAQLatency" target="_blank">Timing Latency Questions</a>（原文出处，翻译整理仅供参考!）</b></font><br></p></div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div id="sites-attachments-container">
</div>
</div>
</div> 
</td> 
<td id="sites-chrome-sidebar-right" class="sites-layout-sidebar-right initial" style="width:190px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_9153814178763965" class="sites-embed" role="navigation"><h4 class="sites-embed-title"> GNURadio 中文社区</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://gnuradio.microembedded.com/" class="sites-navigation-link">GNURadio：中文维客</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://gnuradio.microembedded.com/pageindex" class="sites-navigation-link">标题索引：GNURadio</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_3158427237433027" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="/installinggr" jotid="wuid:gx:19c4ea49ca981168" class="sites-navigation-link">GNURadio: 安装指导</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/faq" jotid="wuid:gx:59d38b2d5aff0b87" class="sites-navigation-link">GNURadio: 常见问题</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/tutorials" jotid="wuid:gx:c2443ff1f7a56ec" class="sites-navigation-link">GNURadio: 讲义教程</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="/development" jotid="wuid:gx:447c739ef5066bd4" class="sites-navigation-link">GNURadio: 社区贡献</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_6502772558432737" class="sites-embed" role="navigation"><h4 class="sites-embed-title"> GNURadio 最新发布</h4><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="https://sites.google.com/a/microembedded.com/gnuradio/news#TOC-GNU-Radio:-GNU-Radio-release-3.6.3-available-for-download" class="sites-navigation-link">GNURadio 3.6.3</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="https://sites.google.com/a/microembedded.com/gnuradio/news#TOC-GNU-Radio:-GNU-Radio-release-candidate-3.6.3rc0-available-for-download" class="sites-navigation-link">GNURadio 3.6.3rc0</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_4277110048101279" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://gnuradio.microembedded.com/openbts" class="sites-navigation-link">GNURadio - OpenBTS 中文维客 </a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_41189823539683246" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://openbts.microembedded.com/" class="sites-navigation-link">（Range）- OpenBTS 中文社区</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_43043355133298733" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_6312697504782834" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://ossie.microembedded.com/" class="sites-navigation-link">SCA - OSSIE 中文维客</a></div></li></ul></div></div>
</td>
</tr>
</tbody></table>
                    <!-- InstanceEndEditable -->
                    </div>
                </div>
                <div id="sites-chrome-footer-wrapper">
                    <div id="sites-chrome-footer-wrapper-inside">
                        <div id="sites-chrome-footer">
                            <div xmlns="http://www.w3.org/1999/xhtml" class="sites-subfooter">
                                <div class="sites-subfooter-content">
                                    <div dir="ltr">
                                        <div style="text-align:center;font-family:simsun,serif">
                                            <div style="overflow:auto"> <font size="2"><span style="border-collapse:separate;color:rgb(0,0,0);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="text-align:center"><span style="border-collapse:separate;color:rgb(0,0,0);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="border-collapse:collapse">"This is an unofficial translation of the Gnu Radio project homepage.  Please use<span> </span><a href="http://gnuradio.org/">http://gnuradio.org/</a><span> </span> in case of any doubt." 此乃 GNU Radio 非官方中文翻译，如有疑问请参阅<span> </span></span></span><a href="http://gnuradio.org">http://gnuradio.org</a>。<br>
                                                <span style="border-collapse:separate;color:rgb(0,0,0);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"><span style="border-collapse:collapse">Chinese translation provided by<br>
                                                <span> </span>
                                                <a href="http://www.microembedded.com/" target="_blank">Microembedded Electronic (Beijing) Co. Ltd.</a><span> </span></span></span><a href="http://www.microembedded.com/" target="_blank">微嵌电子技术（北京）有限责任公司</a>
                                                <span> </span>提供翻译</span></span></font><br><br>
                                                <font>©2009 MicroEmbedded 备案信息：京ICP备15049573号 京公网安备：110108904713</font>
                                                </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="sites-chrome-onebar-footer"> </div>
</body>
<!-- InstanceEnd --></html>